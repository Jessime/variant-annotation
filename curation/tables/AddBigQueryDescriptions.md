Add Column Descriptions to a BigQuery Table
===========================================

The `variants` table generated by performing
an
[export from Google Genomics](https://cloud.google.com/genomics/reference/rest/v1/variantsets/export) does
not include the field descriptions for the fields.

Some fields in the variants table are fixed fields (such as the
`reference_name`, `start`, and `end` fields), while others are variable -
discovered in source VCF or masterVar files during the variant import process.

An ideal tool would be able to pull together a set of descriptions for the
fixed fields, along with descriptions from:

  * the source variant set
  * the source variant files (VCFs or masterVar)
  * descriptions already set in the `variants` table schema

and then allow for easy user additions and edits prior to updating the variants
table schema.

Since most variant sets are built from homogenous VCF files, this script
provides just a simple implementation - provide a VCF used to build your variant
set - it will extract the relevant descriptions from the VCF header and update
the table.  The VCF can be local or in Google Cloud Storage if TensorFlow
libraries are installed.  The VCF may be compressed with gzip and the filename
must end with ".gz" if so.

## Setup

The tool here uses the BigQuery client libraries described at:

      https://cloud.google.com/bigquery/docs/reference/libraries

The following steps install that library in
a
[Python virtual environment](http://docs.python-guide.org/en/latest/dev/virtualenvs/)

1. Create a virtualenv

    ```
    virtualenv bq_lib
    ```

2. Activate the virtualenv

    ```
    source bq_lib/bin/activate
    ```

3. Install the BigQuery client libraries and TensorFlow:

    ```
    pip install --upgrade google-cloud-bigquery tensorflow
    ```

## Run

```shell
python update_variants_schema.py \
  --source-vcf PATH_TO_VCF.vcf \
  --destination-table PROJECT_ID.DATASET_NAME.TABLE_NAME
```

Note the fully-qualified table name follows
BigQuery
[Standard SQL](https://cloud.google.com/bigquery/docs/reference/standard-sql/)
conventions.
